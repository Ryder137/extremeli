<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bookings Management - EXTREMELI SUITES Admin</title>
<link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='images/minlogo.jpg') }}">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}?v=1.0">
</head>
<body>

<header class="admin-header">
  <div class="admin-nav">
    <div class="admin-logo">
      <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="EXTREMELI SUITES">
      <span>Admin Panel</span>
    </div>
    <div class="admin-user">
      <i class="fas fa-user-circle"></i>
      <span>{{ session.get('user_name', 'Admin') }}</span>
      <span class="user-role">({{ user_role.replace('_', ' ').title() }})</span>
      <a href="{{ url_for('admin_logout') }}" class="logout-btn">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    </div>
  </div>
</header>

<nav class="admin-sidebar">
  <ul>
    <li><a href="{{ url_for('admin_dashboard') }}"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
    <li><a href="{{ url_for('admin_features') }}"><i class="fas fa-star"></i> Features</a></li>
    <li><a href="{{ url_for('admin_nearby') }}"><i class="fas fa-map-marker-alt"></i> Nearby Places</a></li>
    <li><a href="{{ url_for('admin_feedback') }}"><i class="fas fa-comments"></i> Feedback</a></li>
    <li><a href="{{ url_for('admin_bookings') }}" class="active"><i class="fas fa-calendar-check"></i> Bookings</a></li>
  </ul>
</nav>

<main class="admin-main">
  <div class="admin-content">
    <div class="page-header">
      <h1><i class="fas fa-calendar-check"></i> Booking Management</h1>
      <p>Manage and track all booking requests</p>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="bookings-stats">
      <div class="stat-card">
        <div class="stat-icon pending">
          <i class="fas fa-clock"></i>
        </div>
        <div class="stat-info">
          <h3>{{ bookings|selectattr('status', 'equalto', 'pending')|list|length }}</h3>
          <p>Pending</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon confirmed">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-info">
          <h3>{{ bookings|selectattr('status', 'equalto', 'confirmed')|list|length }}</h3>
          <p>Confirmed</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon cancelled">
          <i class="fas fa-times-circle"></i>
        </div>
        <div class="stat-info">
          <h3>{{ bookings|selectattr('status', 'equalto', 'cancelled')|list|length }}</h3>
          <p>Cancelled</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon total">
          <i class="fas fa-list"></i>
        </div>
        <div class="stat-info">
          <h3>{{ bookings|length }}</h3>
          <p>Total Bookings</p>
        </div>
      </div>
    </div>

    <div class="bookings-table-container">
      <div class="table-header">
        <h2>All Bookings</h2>
        <div class="filter-controls">
          <select id="statusFilter" onchange="filterBookings()">
            <option value="">All Status</option>
            <option value="pending">Pending</option>
            <option value="confirmed">Confirmed</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
      </div>

      {% if bookings %}
      <div class="table-responsive">
        <table class="bookings-table" id="bookingsTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Guest Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Room Type</th>
              <th>Check-in</th>
              <th>Check-out</th>
              <th>Guests</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for booking in bookings %}
            <tr data-status="{{ booking.status }}">
              <td>#{{ booking.id }}</td>
              <td>{{ booking.name }}</td>
              <td>{{ booking.email }}</td>
              <td>{{ booking.phone }}</td>
              <td>{{ booking.room_type.replace('_', ' ').title() }}</td>
              <td>{{ booking.check_in }}</td>
              <td>{{ booking.check_out }}</td>
              <td>{{ booking.guests }}</td>
              <td>
                <span class="status-badge status-{{ booking.status }}">
                  {{ booking.status.title() }}
                </span>
              </td>
              <td>{{ booking.created_at }}</td>
              <td>
                <div class="action-buttons">
                  <form method="POST" action="{{ url_for('admin_update_booking_status', booking_id=booking.id) }}" class="status-form">
                    <select name="status" class="status-select" onchange="this.form.submit()">
                      <option value="pending" {% if booking.status == 'pending' %}selected{% endif %}>Pending</option>
                      <option value="confirmed" {% if booking.status == 'confirmed' %}selected{% endif %}>Confirmed</option>
                      <option value="cancelled" {% if booking.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                    </select>
                  </form>
                  {% if user_role == 'admin' %}
                  <a href="{{ url_for('admin_delete_booking', booking_id=booking.id) }}" 
                     class="btn-delete" 
                     onclick="return confirm('Are you sure you want to delete this booking?')">
                    <i class="fas fa-trash"></i>
                  </a>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% if booking.special_requests %}
            <tr class="special-requests-row">
              <td colspan="11">
                <div class="special-requests">
                  <strong>Special Requests:</strong> {{ booking.special_requests }}
                </div>
              </td>
            </tr>
            {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="no-bookings">
        <i class="fas fa-calendar-times"></i>
        <h3>No Bookings Yet</h3>
        <p>When guests make booking requests, they will appear here.</p>
      </div>
      {% endif %}
    </div>
  </div>
</main>

<script>
function filterBookings() {
  const filter = document.getElementById('statusFilter').value;
  const rows = document.querySelectorAll('#bookingsTable tbody tr[data-status]');
  
  rows.forEach(row => {
    if (filter === '' || row.dataset.status === filter) {
      row.style.display = '';
      // Show the special requests row if it exists
      const nextRow = row.nextElementSibling;
      if (nextRow && nextRow.classList.contains('special-requests-row')) {
        nextRow.style.display = '';
      }
    } else {
      row.style.display = 'none';
      // Hide the special requests row if it exists
      const nextRow = row.nextElementSibling;
      if (nextRow && nextRow.classList.contains('special-requests-row')) {
        nextRow.style.display = 'none';
      }
    }
  });
}

// Auto-refresh every 30 seconds to get new bookings
setInterval(() => {
  window.location.reload();
}, 30000);
</script>

<style>
.admin-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 15px 30px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.admin-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.admin-logo {
  display: flex;
  align-items: center;
  gap: 15px;
}

.admin-logo img {
  height: 40px;
}

.admin-logo span {
  font-size: 1.2rem;
  font-weight: 600;
}

.admin-user {
  display: flex;
  align-items: center;
  gap: 15px;
}

.user-role {
  opacity: 0.8;
  font-size: 0.9rem;
}

.logout-btn {
  color: white;
  text-decoration: none;
  padding: 8px 15px;
  border-radius: 5px;
  background: rgba(255,255,255,0.1);
  transition: all 0.3s ease;
}

.logout-btn:hover {
  background: rgba(255,255,255,0.2);
}

.admin-sidebar {
  position: fixed;
  left: 0;
  top: 70px;
  width: 250px;
  height: calc(100vh - 70px);
  background: #2c3e50;
  padding: 20px 0;
  overflow-y: auto;
}

.admin-sidebar ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.admin-sidebar li a {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 15px 25px;
  color: #ecf0f1;
  text-decoration: none;
  transition: all 0.3s ease;
}

.admin-sidebar li a:hover,
.admin-sidebar li a.active {
  background: #34495e;
  border-left: 4px solid #3498db;
}

.admin-main {
  margin-left: 250px;
  padding: 30px;
  background: #f8f9fa;
  min-height: calc(100vh - 70px);
}

.admin-content {
  max-width: 1400px;
  margin: 0 auto;
}

.page-header {
  margin-bottom: 30px;
}

.page-header h1 {
  font-size: 2.5rem;
  color: #2c3e50;
  margin-bottom: 10px;
}

.page-header p {
  color: #7f8c8d;
  font-size: 1.1rem;
}

.flash-messages {
  margin-bottom: 25px;
}

.flash-message {
  padding: 15px 20px;
  border-radius: 8px;
  margin-bottom: 15px;
  font-weight: 500;
}

.flash-success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.flash-error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.bookings-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.08);
  display: flex;
  align-items: center;
  gap: 20px;
}

.stat-icon {
  width: 60px;
  height: 60px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
}

.stat-icon.pending {
  background: #fff3cd;
  color: #856404;
}

.stat-icon.confirmed {
  background: #d4edda;
  color: #155724;
}

.stat-icon.cancelled {
  background: #f8d7da;
  color: #721c24;
}

.stat-icon.total {
  background: #d1ecf1;
  color: #0c5460;
}

.stat-info h3 {
  font-size: 2rem;
  margin: 0;
  color: #2c3e50;
}

.stat-info p {
  margin: 5px 0 0 0;
  color: #7f8c8d;
  font-weight: 500;
}

.bookings-table-container {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.08);
  overflow: hidden;
}

.table-header {
  padding: 25px 30px;
  border-bottom: 1px solid #e9ecef;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.table-header h2 {
  margin: 0;
  color: #2c3e50;
}

.filter-controls select {
  padding: 8px 15px;
  border: 2px solid #e9ecef;
  border-radius: 6px;
  font-size: 0.95rem;
}

.table-responsive {
  overflow-x: auto;
}

.bookings-table {
  width: 100%;
  border-collapse: collapse;
}

.bookings-table th {
  background: #f8f9fa;
  padding: 15px;
  text-align: left;
  font-weight: 600;
  color: #2c3e50;
  border-bottom: 2px solid #e9ecef;
}

.bookings-table td {
  padding: 15px;
  border-bottom: 1px solid #e9ecef;
  vertical-align: top;
}

.status-badge {
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
  text-transform: uppercase;
}

.status-pending {
  background: #fff3cd;
  color: #856404;
}

.status-confirmed {
  background: #d4edda;
  color: #155724;
}

.status-cancelled {
  background: #f8d7da;
  color: #721c24;
}

.action-buttons {
  display: flex;
  gap: 10px;
  align-items: center;
}

.status-form {
  margin: 0;
}

.status-select {
  padding: 6px 10px;
  border: 2px solid #e9ecef;
  border-radius: 6px;
  font-size: 0.85rem;
  cursor: pointer;
}

.btn-delete {
  color: #dc3545;
  text-decoration: none;
  padding: 6px 8px;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.btn-delete:hover {
  background: #dc3545;
  color: white;
}

.special-requests-row {
  background: #f8f9fa;
}

.special-requests {
  padding: 15px;
  font-style: italic;
  color: #6c757d;
}

.no-bookings {
  text-align: center;
  padding: 60px 30px;
  color: #6c757d;
}

.no-bookings i {
  font-size: 4rem;
  margin-bottom: 20px;
  opacity: 0.5;
}

.no-bookings h3 {
  margin-bottom: 10px;
  color: #495057;
}

@media (max-width: 768px) {
  .admin-sidebar {
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }
  
  .admin-main {
    margin-left: 0;
    padding: 20px;
  }
  
  .admin-nav {
    flex-direction: column;
    gap: 10px;
  }
  
  .bookings-stats {
    grid-template-columns: 1fr;
  }
  
  .table-header {
    flex-direction: column;
    gap: 15px;
    align-items: flex-start;
  }
  
  .action-buttons {
    flex-direction: column;
    align-items: flex-start;
  }
}
</style>

</body>
</html>
